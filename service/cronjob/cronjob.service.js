const mongoose = require("mongoose");
const axios = require("axios");
const CronjobLog = require("../../models/cronjob.log.model");

// р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╕кр╕│р╕лр╕гр╕▒р╕Ър╕Ър╕▒р╕Щр╕Чр╕╢р╕Б log р╕Бр╕▓р╕гр╕Чр╕│р╕Зр╕▓р╕Щр╕Вр╕нр╕З cronjob
const logCronjobExecution = async (
  jobName,
  lotteryName,
  status,
  result = null,
  error = null,
  startTime = Date.now()
) => {
  try {
    const endTime = Date.now();
    const duration = endTime - startTime;

    const logData = {
      job_name: jobName,
      lottery_name: lotteryName,
      status: status, // 'success' р╕лр╕гр╕╖р╕н 'error'
      execution_time: new Date(startTime),
      duration_ms: duration,
    };

    if (status === "success" && result) {
      logData.lottery_set_id = result.id || result._id;
      logData.additional_info = {
        result_time: result.result_time,
        open_time: result.openTime,
        close_time: result.closeTime,
      };
    }

    if (status === "error" && error) {
      logData.error_message = error.message || error.toString();
      logData.additional_info = {
        stack: error.stack,
        error_details: error,
      };
    }

    await CronjobLog.create(logData);
    console.log(`ЁЯУК р╕Ър╕▒р╕Щр╕Чр╕╢р╕Б log ${jobName}: ${status} (${duration}ms)`);
  } catch (logError) {
    console.error(
      "тЭМ р╣Ар╕Бр╕┤р╕Фр╕Вр╣Йр╕нр╕Ьр╕┤р╕Фр╕Юр╕ер╕▓р╕Фр╣Гр╕Щр╕Бр╕▓р╕гр╕Ър╕▒р╕Щр╕Чр╕╢р╕Б cronjob log:",
      logError.message
    );
  }
};

// ===================== Time Helpers (Server-time aligned) =====================
// р╕лр╕бр╕▓р╕вр╣Ар╕лр╕Хр╕╕: р╣Ар╕зр╕ер╕▓р╕Чр╕╡р╣Ир╕Бр╕│р╕лр╕Щр╕Фр╣Гр╕Щр╣Ар╕нр╕Бр╕кр╕▓р╕гр╣Ар╕Ыр╣Зр╕Щр╣Ар╕зр╕ер╕▓р╣Др╕Чр╕в (Asia/Bangkok, UTC+7)
// р╣Вр╕Др╣Йр╕Фр╕Щр╕╡р╣Йр╕Ир╕░р╣Бр╕Ыр╕ер╕Зр╣Ар╕зр╕ер╕▓р╣Др╕Чр╕вр╣Гр╕лр╣Йр╣Ар╕Ыр╣Зр╕Щ timestamp р╣Ар╕Фр╕╡р╕вр╕зр╕Бр╕▒р╕Щр╣Гр╕Щр╣Вр╕Лр╕Щр╣Ар╕зр╕ер╕▓р╕Вр╕нр╕Зр╣Ар╕Лр╕┤р╕гр╣Мр╕Яр╣Ар╕зр╕нр╕гр╣М
// р╣Вр╕Фр╕вр╣Гр╕Кр╣Й Date.UTC р╣Ар╕Юр╕╖р╣Ир╕нр╕кр╕гр╣Йр╕▓р╕Зр╣Ар╕зр╕ер╕▓р╣Бр╕Ър╕Ъ UTC р╕Ир╕▓р╕Бр╕Др╕нр╕бр╣Вр╕Юр╣Ар╕Щр╕Щр╕Хр╣Мр╕Вр╕нр╕Зр╣Ар╕зр╕ер╕▓р╣Др╕Чр╕в

// р╕Др╕╖р╕Щр╕Др╣Ир╕▓ Date р╕Чр╕╡р╣Ир╣Бр╕Чр╕Щ "р╕зр╕▒р╕Щр╣Ар╕Фр╕╡р╕вр╕зр╕Бр╕▒р╕Ъ baseDate р╕Хр╕▓р╕бр╣Ар╕зр╕ер╕▓р╣Др╕Чр╕в" р╣Бр╕ер╕░р╣Ар╕зр╕ер╕▓р╕Кр╕▒р╣Ир╕зр╣Вр╕бр╕З/р╕Щр╕▓р╕Чр╕╡р╕Чр╕╡р╣Ир╕гр╕░р╕Ър╕╕ (р╣Ар╕зр╕ер╕▓р╣Др╕Чр╕в)
function getBangkokDateAt(hoursThai, minutesThai, baseDate = new Date()) {
  // р╣Бр╕Ыр╕ер╕З baseDate р╣Ар╕Ыр╣Зр╕Щр╕зр╕▒р╕Щр╕Чр╕╡р╣Ир╣Гр╕Щр╣Ар╕зр╕ер╕▓р╣Др╕Чр╕в
  const bangkokDateStr = baseDate.toLocaleDateString("en-CA", {
    timeZone: "Asia/Bangkok",
  }); // YYYY-MM-DD format
  const [year, month, day] = bangkokDateStr.split("-").map(Number);

  // р╕кр╕гр╣Йр╕▓р╕З Date object р╕кр╕│р╕лр╕гр╕▒р╕Ър╣Ар╕зр╕ер╕▓р╣Др╕Чр╕вр╕Чр╕╡р╣Ир╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕г
  // р╣Гр╕Кр╣Й UTC constructor р╣Бр╕ер╣Йр╕зр╕Ър╕зр╕Б offset р╕Вр╕нр╕Зр╣Ар╕зр╕ер╕▓р╣Др╕Чр╕в
  const utcTime = Date.UTC(
    year,
    month - 1,
    day,
    hoursThai - 7,
    minutesThai,
    0,
    0
  );
  return new Date(utcTime);
}

// р╕Др╕╖р╕Щр╕Др╣Ир╕▓р╣Ар╕Чр╕╡р╣Ир╕вр╕Зр╕Др╕╖р╕Щр╕Вр╕нр╕Зр╕зр╕▒р╕Щр╣Ар╕Фр╕╡р╕вр╕зр╕Бр╕▒р╕Ъ dateRef р╕Хр╕▓р╕бр╣Ар╕зр╕ер╕▓р╣Др╕Чр╕в (Bangkok midnight) р╣Ар╕Ыр╣Зр╕Щ Date р╣Ар╕Лр╕┤р╕гр╣Мр╕Яр╣Ар╕зр╕нр╕гр╣М
function getBangkokMidnight(dateRef) {
  // р╣Бр╕Ыр╕ер╕З dateRef р╣Ар╕Ыр╣Зр╕Щр╕зр╕▒р╕Щр╕Чр╕╡р╣Ир╣Гр╕Щр╣Ар╕зр╕ер╕▓р╣Др╕Чр╕в
  const bangkokDateStr = dateRef.toLocaleDateString("en-CA", {
    timeZone: "Asia/Bangkok",
  }); // YYYY-MM-DD format
  const [year, month, day] = bangkokDateStr.split("-").map(Number);

  // р╕кр╕гр╣Йр╕▓р╕Зр╣Ар╕Чр╕╡р╣Ир╕вр╕Зр╕Др╕╖р╕Щр╣Гр╕Щр╣Ар╕зр╕ер╕▓р╣Др╕Чр╕в (00:00:00) р╣Бр╕ер╣Йр╕зр╣Бр╕Ыр╕ер╕Зр╣Ар╕Ыр╣Зр╕Щ UTC
  const utcTime = Date.UTC(year, month - 1, day, 0 - 7, 0, 0, 0); // р╕ер╕Ъ 7 р╕Кр╕▒р╣Ир╕зр╣Вр╕бр╕Зр╕кр╕│р╕лр╕гр╕▒р╕Ъ UTC+7
  return new Date(utcTime);
}

const lotteryLaoService = require("../lottery/lottery_lao.service");
const lotteryLaoExtraService = require("../lottery/lottery_lao_extra.service");
const lotteryLaoStarsService = require("../lottery/lottery_lao_stars.service");
const lotteryLaoUnionService = require("../lottery/lottery_lao_union.service");

// Import services р╕кр╕│р╕лр╕гр╕▒р╕Ър╕лр╕зр╕вр╕ер╕▓р╕зр╣Бр╕Хр╣Ир╕ер╕░р╕Ыр╕гр╕░р╣Ар╕ар╕Ч
const lotteryLaoHdService = require("../lottery/lottery_lao_hd.service");
const lotteryLaoVipService = require("../lottery/lottery_lao_vip.service");
const lotteryLaoStarsVipService = require("../lottery/lottery_lao_stars_vip.service");
const lotteryLaoRedcrossService = require("../lottery/lottery_lao_redcross.service");
const lotteryLaoThakhek5dService = require("../lottery/lottery_lao_thakhek_5d.service");
const lotteryLaoThakhekVipService = require("../lottery/lottery_lao_thakhek_vip.service");
const lotteryLaoTvService = require("../lottery/lottery_lao_tv.service");

// Import services р╕кр╕│р╕лр╕гр╕▒р╕Ър╕лр╕зр╕в 4D
const lotteryMagnum4dService = require("../lottery/lottery_magnum_4d.service");
const lotterySingapore4dService = require("../lottery/lottery_singapore_4d.service");
const lotteryGrandDragon4dService = require("../lottery/lottery_grand_dragon_4d.service");

// Import services р╕кр╕│р╕лр╕гр╕▒р╕Ър╕лр╕зр╕вр╣Др╕Чр╕в
const lotteryThaiGsbService = require("../lottery/lottery_thai_gsb.service");
const lotteryThaiSavingsService = require("../lottery/lottery_thai_savings.service");

// Import services р╕кр╕│р╕лр╕гр╕▒р╕Ър╕лр╕зр╕вр╕ор╕▓р╕Щр╕нр╕в
const lotteryHanoiAseanService = require("../lottery/lottery_hanoi_asean.service");
const lotteryHanoiHdService = require("../lottery/lottery_hanoi_hd.service");
const lotteryHanoiStarService = require("../lottery/lottery_hanoi_star.service");
const lotteryHanoiTvService = require("../lottery/lottery_hanoi_tv.service");
const lotteryHanoiSpecialService = require("../lottery/lottery_hanoi_special.service");
const lotteryHanoiRedcrossService = require("../lottery/lottery_hanoi_redcross.service");
const lotteryHanoiSpecialApiService = require("../lottery/lottery_hanoi_special_api.service");
const lotteryHanoiService = require("../lottery/lottery_hanoi.service");
const lotteryHanoiDevelopService = require("../lottery/lottery_hanoi_develop.service");
const lotteryHanoiVipService = require("../lottery/lottery_hanoi_vip.service");
const lotteryHanoiExtraService = require("../lottery/lottery_hanoi_extra.service");
const lotteryEgyptStockService = require("../lottery/lottery_egypt_stock.service");
const lotteryKoreanStockVipService = require("../lottery/lottery_korean_stock_vip.service");
const lotteryHangsengAfternoonService = require("../lottery/lottery_hangseng_afternoon.service");

// Helper function р╕кр╕│р╕лр╕гр╕▒р╕Ъ retry mechanism
const retryWithDelay = async (fn, delaySeconds = 5) => {
  let attempt = 1;

  while (true) {
    try {
      const result = await fn();

      // р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓р╕Ьр╕ер╕лр╕зр╕вр╕нр╕нр╕Бр╕Др╕гр╕Ър╕лр╕гр╕╖р╕нр╕вр╕▒р╕З (р╣Др╕бр╣Ир╕бр╕╡ "xxx", "xx", "xxxx", "xxxxx")
      if (result && result.results) {
        const hasIncompleteResults = Object.values(result.results).some(
          value => {
            if (typeof value === "string") {
              // р╣Ар╕Кр╣Зр╕Д "xxx", "xx", "xxxx", "xxxxx" р╕лр╕гр╕╖р╕нр╕Др╣Ир╕▓р╕зр╣Ир╕▓р╕З
              return (
                value.includes("xxx") ||
                value.includes("xx") ||
                value === "" ||
                value === null ||
                value === undefined
              );
            }
            return value === null || value === undefined;
          }
        );

        if (!hasIncompleteResults) {
          console.log(`тЬЕ р╕Ьр╕ер╕лр╕зр╕вр╕нр╕нр╕Бр╕Др╕гр╕Ър╣Бр╕ер╣Йр╕з р╕лр╕ер╕▒р╕Зр╕Ир╕▓р╕Бр╕ер╕нр╕З ${attempt} р╕Др╕гр╕▒р╣Йр╕З`);
          return result;
        }

        console.log(
          `тП│ р╕Ьр╕ер╕лр╕зр╕вр╕вр╕▒р╕Зр╣Др╕бр╣Ир╕нр╕нр╕Бр╕Др╕гр╕Ъ (р╕бр╕╡ "xxx") р╕ер╕нр╕Зр╣Гр╕лр╕бр╣Ир╣Гр╕Щ ${delaySeconds} р╕зр╕┤р╕Щр╕▓р╕Чр╕╡ (р╕Др╕гр╕▒р╣Йр╕Зр╕Чр╕╡р╣И ${attempt})`
        );
        console.log(`ЁЯУК р╕Ьр╕ер╕Ыр╕▒р╕Ир╕Ир╕╕р╕Ър╕▒р╕Щ:`, JSON.stringify(result.results, null, 2));
      }

      await new Promise(resolve => setTimeout(resolve, delaySeconds * 1000));
      attempt++;
    } catch (error) {
      console.error(
        `тЭМ р╣Ар╕Бр╕┤р╕Фр╕Вр╣Йр╕нр╕Ьр╕┤р╕Фр╕Юр╕ер╕▓р╕Фр╣Гр╕Щр╕Бр╕▓р╕гр╕ер╕нр╕Зр╕Др╕гр╕▒р╣Йр╕Зр╕Чр╕╡р╣И ${attempt}:`,
        error.message
      );
      console.log(`тП│ р╕ер╕нр╕Зр╣Гр╕лр╕бр╣Ир╣Гр╕Щ ${delaySeconds} р╕зр╕┤р╕Щр╕▓р╕Чр╕╡`);
      await new Promise(resolve => setTimeout(resolve, delaySeconds * 1000));
      attempt++;
    }
  }
};

// р╕лр╕зр╕вр╕ер╕▓р╕зр╕Юр╕▒р╕Тр╕Щр╕▓
exports.huaylaocronjob = async function () {
  return await retryWithDelay(
    () => lotteryLaoService.fetchAndSaveLaoLottery(),
    60 // р╕гр╕н 1 р╕Щр╕▓р╕Чр╕╡р╕гр╕░р╕лр╕зр╣Ир╕▓р╕Зр╕Бр╕▓р╕гр╕ер╕нр╕З
  );
};

// р╕лр╕зр╕вр╕ер╕▓р╕з Extra
exports.huaylaoextracronjob = async function () {
  return await retryWithDelay(
    () => lotteryLaoExtraService.fetchAndSaveLaoExtraLottery(),
    60 // р╕гр╕н 1 р╕Щр╕▓р╕Чр╕╡р╕гр╕░р╕лр╕зр╣Ир╕▓р╕Зр╕Бр╕▓р╕гр╕ер╕нр╕З
  );
};

// р╕лр╕зр╕вр╕ер╕▓р╕зр╕кр╕Хр╕▓р╕гр╣М
exports.huaylaostarcronjob = async function () {
  return await retryWithDelay(
    () => lotteryLaoStarsService.fetchAndSaveLaoStarsLottery(),
    60 // р╕гр╕н 1 р╕Щр╕▓р╕Чр╕╡р╕гр╕░р╕лр╕зр╣Ир╕▓р╕Зр╕Бр╕▓р╕гр╕ер╕нр╕З
  );
};

// р╕лр╕зр╕вр╕ер╕▓р╕зр╕кр╕▓р╕бр╕▒р╕Др╕Др╕╡
exports.huaylaounioncronjob = async function () {
  return await retryWithDelay(
    () => lotteryLaoUnionService.fetchLatestResult(),
    60 // р╕гр╕н 1 р╕Щр╕▓р╕Чр╕╡р╕гр╕░р╕лр╕зр╣Ир╕▓р╕Зр╕Бр╕▓р╕гр╕ер╕нр╕З
  );
};

// р╕лр╕зр╕вр╕ер╕▓р╕з HD
exports.huaylaohd = async function () {
  return await retryWithDelay(
    () => lotteryLaoHdService.fetchAndSaveLaoHdLottery(),
    60 // р╕гр╕н 1 р╕Щр╕▓р╕Чр╕╡р╕гр╕░р╕лр╕зр╣Ир╕▓р╕Зр╕Бр╕▓р╕гр╕ер╕нр╕З
  );
};

// р╕лр╕зр╕вр╕ер╕▓р╕з VIP
exports.huaylaovip = async function () {
  return await retryWithDelay(
    () => lotteryLaoVipService.fetchAndSaveLaoVipLottery(),
    60 // р╕гр╕н 1 р╕Щр╕▓р╕Чр╕╡р╕гр╕░р╕лр╕зр╣Ир╕▓р╕Зр╕Бр╕▓р╕гр╕ер╕нр╕З
  );
};

// р╕лр╕зр╕вр╕ер╕▓р╕зр╕кр╕Хр╕▓р╕гр╣М VIP
exports.huaylaostarvip = async function () {
  return await retryWithDelay(
    () => lotteryLaoStarsVipService.fetchAndSaveLaoStarsVipLottery(),
    60 // р╕гр╕н 1 р╕Щр╕▓р╕Чр╕╡р╕гр╕░р╕лр╕зр╣Ир╕▓р╕Зр╕Бр╕▓р╕гр╕ер╕нр╕З
  );
};

// р╕лр╕зр╕вр╕ер╕▓р╕зр╕Бр╕▓р╕Кр╕▓р╕Ф
exports.huylaogachad = async function () {
  return await retryWithDelay(
    () => lotteryLaoRedcrossService.fetchAndSaveLaoRedcrossLottery(),
    60 // р╕гр╕н 1 р╕Щр╕▓р╕Чр╕╡р╕гр╕░р╕лр╕зр╣Ир╕▓р╕Зр╕Бр╕▓р╕гр╕ер╕нр╕З
  );
};

// р╕лр╕зр╕вр╕ер╕▓р╕зр╕Чр╕│р╣Ар╕Щр╕╡р╕вр╕Ъ 5D
exports.huaylaothakhek5d = async function () {
  return await retryWithDelay(
    () => lotteryLaoThakhek5dService.fetchAndSaveLaoThakhek5dLottery(),
    60 // р╕гр╕н 1 р╕Щр╕▓р╕Чр╕╡р╕гр╕░р╕лр╕зр╣Ир╕▓р╕Зр╕Бр╕▓р╕гр╕ер╕нр╕З
  );
};

// р╕лр╕зр╕вр╕ер╕▓р╕зр╕Чр╕│р╣Ар╕Щр╕╡р╕вр╕Ъ VIP
exports.huaylaothakhekvip = async function () {
  return await retryWithDelay(
    () => lotteryLaoThakhekVipService.fetchAndSaveLaoThakhekVipLottery(),
    60 // р╕гр╕н 1 р╕Щр╕▓р╕Чр╕╡р╕гр╕░р╕лр╕зр╣Ир╕▓р╕Зр╕Бр╕▓р╕гр╕ер╕нр╕З
  );
};

// р╕лр╕зр╕вр╕ер╕▓р╕з TV
exports.huaylaotv = async function () {
  return await retryWithDelay(
    () => lotteryLaoTvService.fetchAndSaveLaoTvLottery(),
    60 // р╕гр╕н 1 р╕Щр╕▓р╕Чр╕╡р╕гр╕░р╕лр╕зр╣Ир╕▓р╕Зр╕Бр╕▓р╕гр╕ер╕нр╕З
  );
};

// р╕лр╕зр╕в Magnum 4D
exports.huaymagnum4d = async function () {
  return await retryWithDelay(
    () => lotteryMagnum4dService.fetchAndSaveMagnum4dLottery(),
    60 // р╕гр╕н 1 р╕Щр╕▓р╕Чр╕╡р╕гр╕░р╕лр╕зр╣Ир╕▓р╕Зр╕Бр╕▓р╕гр╕ер╕нр╕З
  );
};

// р╕лр╕зр╕в Singapore 4D
exports.huaysingapore4d = async function () {
  return await retryWithDelay(
    () => lotterySingapore4dService.fetchAndSaveSingapore4dLottery(),
    60 // р╕гр╕н 1 р╕Щр╕▓р╕Чр╕╡р╕гр╕░р╕лр╕зр╣Ир╕▓р╕Зр╕Бр╕▓р╕гр╕ер╕нр╕З
  );
};

// р╕лр╕зр╕в Grand Dragon 4D
exports.huaygranddragon4d = async function () {
  return await retryWithDelay(
    () => lotteryGrandDragon4dService.fetchAndSaveGrandDragon4dLottery(),
    60 // р╕гр╕н 1 р╕Щр╕▓р╕Чр╕╡р╕гр╕░р╕лр╕зр╣Ир╕▓р╕Зр╕Бр╕▓р╕гр╕ер╕нр╕З
  );
};

// р╕лр╕зр╕вр╣Др╕Чр╕в GSB
exports.huaythaigsb = async function () {
  return await retryWithDelay(
    () => lotteryThaiGsbService.fetchAndSaveThaiGsbLottery(),
    60 // р╕гр╕н 1 р╕Щр╕▓р╕Чр╕╡р╕гр╕░р╕лр╕зр╣Ир╕▓р╕Зр╕Бр╕▓р╕гр╕ер╕нр╕З
  );
};

// р╕лр╕зр╕вр╣Др╕Чр╕вр╕нр╕нр╕бр╕кр╕┤р╕Щ
exports.huaythaisavings = async function () {
  return await retryWithDelay(
    () => lotteryThaiSavingsService.fetchAndSaveThaiSavingsLottery(),
    60 // р╕гр╕н 1 р╕Щр╕▓р╕Чр╕╡р╕гр╕░р╕лр╕зр╣Ир╕▓р╕Зр╕Бр╕▓р╕гр╕ер╕нр╕З
  );
};

// р╕лр╕зр╕вр╕ор╕▓р╕Щр╕нр╕вр╕нр╕▓р╣Ар╕Лр╕╡р╕вр╕Щ
exports.huayhanoiasean = async function () {
  return await retryWithDelay(
    () => lotteryHanoiAseanService.fetchAndSaveHanoiAseanLottery(),
    60 // р╕гр╕н 1 р╕Щр╕▓р╕Чр╕╡р╕гр╕░р╕лр╕зр╣Ир╕▓р╕Зр╕Бр╕▓р╕гр╕ер╕нр╕З
  );
};

// р╕лр╕зр╕вр╕ор╕▓р╕Щр╕нр╕в HD
exports.huayhanoihd = async function () {
  return await retryWithDelay(
    () => lotteryHanoiHdService.fetchAndSaveHanoiHdLottery(),
    60 // р╕гр╕н 1 р╕Щр╕▓р╕Чр╕╡р╕гр╕░р╕лр╕зр╣Ир╕▓р╕Зр╕Бр╕▓р╕гр╕ер╕нр╕З
  );
};

// р╕лр╕зр╕вр╕ор╕▓р╕Щр╕нр╕вр╕кр╕Хр╕▓р╕гр╣М
exports.huayhanoistar = async function () {
  return await retryWithDelay(
    () => lotteryHanoiStarService.fetchAndSaveHanoiStarLottery(),
    60 // р╕гр╕н 1 р╕Щр╕▓р╕Чр╕╡р╕гр╕░р╕лр╕зр╣Ир╕▓р╕Зр╕Бр╕▓р╕гр╕ер╕нр╕З
  );
};

// р╕лр╕зр╕вр╕ор╕▓р╕Щр╕нр╕в TV
exports.huayhanoitv = async function () {
  return await retryWithDelay(
    () => lotteryHanoiTvService.fetchAndSaveHanoiTvLottery(),
    60 // р╕гр╕н 1 р╕Щр╕▓р╕Чр╕╡р╕гр╕░р╕лр╕зр╣Ир╕▓р╕Зр╕Бр╕▓р╕гр╕ер╕нр╕З
  );
};

// р╕лр╕зр╕вр╕ор╕▓р╕Щр╕нр╕вр╣Ар╕Йр╕Юр╕▓р╕░р╕Бр╕┤р╕И
exports.huayhanoispecial = async function () {
  return await retryWithDelay(
    () => lotteryHanoiSpecialService.fetchAndSaveHanoiSpecialLottery(),
    60 // р╕гр╕н 1 р╕Щр╕▓р╕Чр╕╡р╕гр╕░р╕лр╕зр╣Ир╕▓р╕Зр╕Бр╕▓р╕гр╕ер╕нр╕З
  );
};

// р╕лр╕зр╕вр╕ор╕▓р╕Щр╕нр╕вр╕Бр╕▓р╕Кр╕▓р╕Ф
exports.huayhanoiredcross = async function () {
  return await retryWithDelay(
    () => lotteryHanoiRedcrossService.fetchAndSaveHanoiRedcrossLottery(),
    60 // р╕гр╕н 1 р╕Щр╕▓р╕Чр╕╡р╕гр╕░р╕лр╕зр╣Ир╕▓р╕Зр╕Бр╕▓р╕гр╕ер╕нр╕З
  );
};

// р╕лр╕зр╕вр╕ор╕▓р╕Щр╕нр╕вр╕Юр╕┤р╣Ар╕ир╕й
exports.huayhanoispecialapi = async function () {
  return await retryWithDelay(
    () => lotteryHanoiSpecialApiService.fetchAndSaveHanoiSpecialApiLottery(),
    60 // р╕гр╕н 1 р╕Щр╕▓р╕Чр╕╡р╕гр╕░р╕лр╕зр╣Ир╕▓р╕Зр╕Бр╕▓р╕гр╕ер╕нр╕З
  );
};

// р╕лр╕зр╕вр╕ор╕▓р╕Щр╕нр╕в
exports.huayhanoi = async function () {
  return await retryWithDelay(
    () => lotteryHanoiService.fetchAndSaveHanoiLottery(),
    60 // р╕гр╕н 1 р╕Щр╕▓р╕Чр╕╡р╕гр╕░р╕лр╕зр╣Ир╕▓р╕Зр╕Бр╕▓р╕гр╕ер╕нр╕З
  );
};

// р╕лр╕зр╕вр╕ор╕▓р╕Щр╕нр╕вр╕Юр╕▒р╕Тр╕Щр╕▓
exports.huayhanoidevelop = async function () {
  return await retryWithDelay(
    () => lotteryHanoiDevelopService.fetchAndSaveHanoiDevelopLottery(),
    60 // р╕гр╕н 1 р╕Щр╕▓р╕Чр╕╡р╕гр╕░р╕лр╕зр╣Ир╕▓р╕Зр╕Бр╕▓р╕гр╕ер╕нр╕З
  );
};

// р╕лр╕зр╕вр╕ор╕▓р╕Щр╕нр╕в VIP
exports.huayhanoivip = async function () {
  return await retryWithDelay(
    () => lotteryHanoiVipService.fetchAndSaveHanoiVipLottery(),
    60 // р╕гр╕н 1 р╕Щр╕▓р╕Чр╕╡р╕гр╕░р╕лр╕зр╣Ир╕▓р╕Зр╕Бр╕▓р╕гр╕ер╕нр╕З
  );
};

// р╕лр╕зр╕вр╕ор╕▓р╕Щр╕нр╕в EXTRA
exports.huayhanoiextra = async function () {
  return await retryWithDelay(
    () => lotteryHanoiExtraService.fetchAndSaveHanoiExtraLottery(),
    60 // р╕гр╕н 1 р╕Щр╕▓р╕Чр╕╡р╕гр╕░р╕лр╕зр╣Ир╕▓р╕Зр╕Бр╕▓р╕гр╕ер╕нр╕З
  );
};

// р╕лр╕зр╕вр╕лр╕╕р╣Йр╕Щр╕нр╕┤р╕вр╕┤р╕Ыр╕Хр╣М
exports.huayegyptstock = async function () {
  return await retryWithDelay(
    () => lotteryEgyptStockService.fetchAndSaveEgyptStockLottery(),
    60 // р╕гр╕н 1 р╕Щр╕▓р╕Чр╕╡р╕гр╕░р╕лр╕зр╣Ир╕▓р╕Зр╕Бр╕▓р╕гр╕ер╕нр╕З
  );
};

// р╕лр╕зр╕вр╕лр╕╕р╣Йр╕Щр╣Ар╕Бр╕▓р╕лр╕ер╕╡ VIP
exports.huaykoreanstockvip = async function () {
  return await retryWithDelay(
    () => lotteryKoreanStockVipService.fetchAndSaveKoreanStockVipLottery(),
    60 // р╕гр╕н 1 р╕Щр╕▓р╕Чр╕╡р╕гр╕░р╕лр╕зр╣Ир╕▓р╕Зр╕Бр╕▓р╕гр╕ер╕нр╕З
  );
};

// р╕лр╕зр╕вр╕ор╕▒р╣Ир╕Зр╣Ар╕кр╣Зр╕Зр╕гр╕нр╕Ър╕Ър╣Ир╕▓р╕в
exports.huayhangsengafternoon = async function () {
  return await retryWithDelay(
    () =>
      lotteryHangsengAfternoonService.fetchAndSaveHangsengAfternoonLottery(),
    60 // р╕гр╕н 1 р╕Щр╕▓р╕Чр╕╡р╕гр╕░р╕лр╕зр╣Ир╕▓р╕Зр╕Бр╕▓р╕гр╕ер╕нр╕З
  );
};

// Wrapper р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╕кр╕│р╕лр╕гр╕▒р╕Ъ cronjob р╕Юр╕гр╣Йр╕нр╕б logging
const createCronjobWithLogging = async (
  jobName,
  lotteryName,
  createFunction
) => {
  const startTime = Date.now();
  try {
    const result = await createFunction();
    await logCronjobExecution(
      jobName,
      lotteryName,
      "success",
      result,
      null,
      startTime
    );
    return result;
  } catch (error) {
    await logCronjobExecution(
      jobName,
      lotteryName,
      "error",
      null,
      error,
      startTime
    );
    throw error;
  }
};

//р╕кр╕гр╣Йр╕▓р╕З lotteryset р╕лр╕зр╕вр╕гр╕▒р╕Рр╕Ър╕▓р╕е
exports.createThaiGovernmentLottery = async function () {
  try {
    const { createLotterySets } = require("../lottery/lotterySets.service");
    const LotteryType = require("../../models/lotteryType.model");

    console.log("ЁЯПЫя╕П р╣Ар╕гр╕┤р╣Ир╕бр╕кр╕гр╣Йр╕▓р╕Зр╕лр╕зр╕вр╕гр╕▒р╕Рр╕Ър╕▓р╕е...");

    // р╕лр╕▓ lottery_type_id р╕кр╕│р╕лр╕гр╕▒р╕Ър╕лр╕зр╕вр╕гр╕▒р╕Рр╕Ър╕▓р╕е
    const lotteryType = await LotteryType.findOne({ lottery_type: "р╕лр╕зр╕вр╣Др╕Чр╕в" });
    if (!lotteryType) {
      throw new Error("р╣Др╕бр╣Ир╕Юр╕Ър╕Ыр╕гр╕░р╣Ар╕ар╕Чр╕лр╕зр╕вр╣Др╕Чр╕вр╣Гр╕Щр╕гр╕░р╕Ър╕Ъ");
    }

    const now = new Date();
    const currentDate = now.getDate();
    const currentMonth = now.getMonth();
    const currentYear = now.getFullYear();

    let drawDate, resultTime;

    // р╕Цр╣Йр╕▓р╕кр╕гр╣Йр╕▓р╕Зр╕зр╕▒р╕Щр╕Чр╕╡р╣И 2 = р╕нр╕нр╕Бр╕Ьр╕ер╕зр╕▒р╕Щр╕Чр╕╡р╣И 16 р╕Вр╕нр╕Зр╣Ар╕Фр╕╖р╕нр╕Щр╣Ар╕Фр╕╡р╕вр╕зр╕Бр╕▒р╕Щ
    if (currentDate === 2) {
      // р╕нр╕нр╕Бр╕Ьр╕ер╕зр╕▒р╕Щр╕Чр╕╡р╣И 16 р╕Вр╕нр╕Зр╣Ар╕Фр╕╖р╕нр╕Щр╣Ар╕Фр╕╡р╕вр╕зр╕Бр╕▒р╕Щ р╣Ар╕зр╕ер╕▓ 16:30
      drawDate = new Date(currentYear, currentMonth, 16);
      resultTime = getBangkokDateAt(16, 30, drawDate);
    }
    // р╕Цр╣Йр╕▓р╕кр╕гр╣Йр╕▓р╕Зр╕зр╕▒р╕Щр╕Чр╕╡р╣И 17 = р╕нр╕нр╕Бр╕Ьр╕ер╕зр╕▒р╕Щр╕Чр╕╡р╣И 1 р╕Вр╕нр╕Зр╣Ар╕Фр╕╖р╕нр╕Щр╕Цр╕▒р╕Фр╣Др╕Ы
    else if (currentDate === 17) {
      // р╕нр╕нр╕Бр╕Ьр╕ер╕зр╕▒р╕Щр╕Чр╕╡р╣И 1 р╕Вр╕нр╕Зр╣Ар╕Фр╕╖р╕нр╕Щр╕Цр╕▒р╕Фр╣Др╕Ы р╣Ар╕зр╕ер╕▓ 16:30
      drawDate = new Date(currentYear, currentMonth + 1, 1);
      resultTime = getBangkokDateAt(16, 30, drawDate);
    } else {
      console.log("тП░ р╣Др╕бр╣Ир╣Гр╕Кр╣Ир╕зр╕▒р╕Щр╕Чр╕╡р╣Ир╕кр╕гр╣Йр╕▓р╕Зр╕лр╕зр╕вр╕гр╕▒р╕Рр╕Ър╕▓р╕е (р╕зр╕▒р╕Щр╕Чр╕╡р╣И 2 р╕лр╕гр╕╖р╕н 17)");
      return;
    }

    // р╕кр╕гр╣Йр╕▓р╕Зр╕Кр╕╖р╣Ир╕нр╕Зр╕зр╕Ф
    const monthNames = [
      "р╕бр╕Бр╕гр╕▓р╕Др╕б",
      "р╕Бр╕╕р╕бр╕ар╕▓р╕Юр╕▒р╕Щр╕Шр╣М",
      "р╕бр╕╡р╕Щр╕▓р╕Др╕б",
      "р╣Ар╕бр╕йр╕▓р╕вр╕Щ",
      "р╕Юр╕др╕йр╕ар╕▓р╕Др╕б",
      "р╕бр╕┤р╕Цр╕╕р╕Щр╕▓р╕вр╕Щ",
      "р╕Бр╕гр╕Бр╕Ор╕▓р╕Др╕б",
      "р╕кр╕┤р╕Зр╕лр╕▓р╕Др╕б",
      "р╕Бр╕▒р╕Щр╕вр╕▓р╕вр╕Щ",
      "р╕Хр╕╕р╕ер╕▓р╕Др╕б",
      "р╕Юр╕др╕ир╕Ир╕┤р╕Бр╕▓р╕вр╕Щ",
      "р╕Шр╕▒р╕Щр╕зр╕▓р╕Др╕б",
    ];

    const drawMonth = drawDate.getMonth();
    const drawYear = drawDate.getFullYear() + 543; // р╣Бр╕Ыр╕ер╕Зр╣Ар╕Ыр╣Зр╕Щ р╕Ю.р╕и.
    const roundNumber = drawDate.getDate() === 1 ? 1 : 2;

    const lotteryData = {
      lottery_type_id: lotteryType._id,
      name: "р╕лр╕зр╕вр╕гр╕▒р╕Рр╕Ър╕▓р╕е",
      openTime: now, // р╣Ар╕гр╕┤р╣Ир╕бр╣Бр╕Чр╕Зр╣Др╕Фр╣Йр╕Чр╕▒р╕Щр╕Чр╕╡ (р╣Ар╕зр╕ер╕▓р╣Ар╕Лр╕┤р╕гр╣Мр╕Яр╣Ар╕зр╕нр╕гр╣М)
      closeTime: new Date(resultTime.getTime() - 30 * 60 * 1000), // р╕лр╕вр╕╕р╕Фр╣Бр╕Чр╕З 30 р╕Щр╕▓р╕Чр╕╡р╕Бр╣Ир╕нр╕Щр╕нр╕нр╕Бр╕Ьр╕е
      result_time: resultTime,
      status: "scheduled",
    };

    // р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓р╕бр╕╡р╕Зр╕зр╕Фр╕Щр╕╡р╣Йр╣Бр╕ер╣Йр╕зр╕лр╕гр╕╖р╕нр╕вр╕▒р╕З
    const LotterySets = require("../../models/lotterySets.model");
    const existingSet = await LotterySets.findOne({
      name: "р╕лр╕зр╕вр╕гр╕▒р╕Рр╕Ър╕▓р╕е",
      result_time: resultTime,
    });

    if (existingSet) {
      console.log(
        `тЪая╕П р╕лр╕зр╕вр╕гр╕▒р╕Рр╕Ър╕▓р╕ер╕Зр╕зр╕Фр╕зр╕▒р╕Щр╕Чр╕╡р╣И ${drawDate.getDate()} ${
          monthNames[drawMonth]
        } ${drawYear} р╕бр╕╡р╕нр╕вр╕╣р╣Ир╣Бр╕ер╣Йр╕з`
      );
      return existingSet;
    }

    const createdLottery = await createLotterySets(lotteryData);

    console.log(`тЬЕ р╕кр╕гр╣Йр╕▓р╕Зр╕лр╕зр╕вр╕гр╕▒р╕Рр╕Ър╕▓р╕ер╕кр╕│р╣Ар╕гр╣Зр╕И: ${createdLottery.id}`);
    console.log(
      `ЁЯУЕ р╕зр╕▒р╕Щр╕нр╕нр╕Бр╕Ьр╕е: ${resultTime.toLocaleString("th-TH", {
        timeZone: "Asia/Bangkok",
      })}`
    );

    return createdLottery;
  } catch (error) {
    console.error("тЭМ р╣Ар╕Бр╕┤р╕Фр╕Вр╣Йр╕нр╕Ьр╕┤р╕Фр╕Юр╕ер╕▓р╕Фр╣Гр╕Щр╕Бр╕▓р╕гр╕кр╕гр╣Йр╕▓р╕Зр╕лр╕зр╕вр╕гр╕▒р╕Рр╕Ър╕▓р╕е:", error.message);
    throw error;
  }
};

//р╕кр╕гр╣Йр╕▓р╕З lotteryset р╕лр╕зр╕вр╕нр╕нр╕бр╕кр╕┤р╕Щ
exports.createThaiSavingsLottery = async function () {
  try {
    const { createLotterySets } = require("../lottery/lotterySets.service");
    const LotteryType = require("../../models/lotteryType.model");

    console.log("ЁЯПж р╣Ар╕гр╕┤р╣Ир╕бр╕кр╕гр╣Йр╕▓р╕Зр╕лр╕зр╕вр╕нр╕нр╕бр╕кр╕┤р╕Щ...");

    // р╕лр╕▓ lottery_type_id р╕кр╕│р╕лр╕гр╕▒р╕Ър╕лр╕зр╕вр╕нр╕нр╕бр╕кр╕┤р╕Щ
    const lotteryType = await LotteryType.findOne({ lottery_type: "р╕лр╕зр╕вр╣Др╕Чр╕в" });
    if (!lotteryType) {
      throw new Error("р╣Др╕бр╣Ир╕Юр╕Ър╕Ыр╕гр╕░р╣Ар╕ар╕Чр╕лр╕зр╕вр╣Др╕Чр╕вр╣Гр╕Щр╕гр╕░р╕Ър╕Ъ");
    }

    const now = new Date();
    const currentDate = now.getDate();
    const currentMonth = now.getMonth();
    const currentYear = now.getFullYear();

    let drawDate, resultTime;

    // р╕Цр╣Йр╕▓р╕кр╕гр╣Йр╕▓р╕Зр╕зр╕▒р╕Щр╕Чр╕╡р╣И 2 = р╕нр╕нр╕Бр╕Ьр╕ер╕зр╕▒р╕Щр╕Чр╕╡р╣И 16 р╕Вр╕нр╕Зр╣Ар╕Фр╕╖р╕нр╕Щр╣Ар╕Фр╕╡р╕вр╕зр╕Бр╕▒р╕Щ
    if (currentDate === 2) {
      // р╕нр╕нр╕Бр╕Ьр╕ер╕зр╕▒р╕Щр╕Чр╕╡р╣И 16 р╕Вр╕нр╕Зр╣Ар╕Фр╕╖р╕нр╕Щр╣Ар╕Фр╕╡р╕вр╕зр╕Бр╕▒р╕Щ р╣Ар╕зр╕ер╕▓ 16:30
      drawDate = new Date(currentYear, currentMonth, 16);
      resultTime = getBangkokDateAt(16, 30, drawDate);
    }
    // р╕Цр╣Йр╕▓р╕кр╕гр╣Йр╕▓р╕Зр╕зр╕▒р╕Щр╕Чр╕╡р╣И 17 = р╕нр╕нр╕Бр╕Ьр╕ер╕зр╕▒р╕Щр╕Чр╕╡р╣И 1 р╕Вр╕нр╕Зр╣Ар╕Фр╕╖р╕нр╕Щр╕Цр╕▒р╕Фр╣Др╕Ы
    else if (currentDate === 17) {
      // р╕нр╕нр╕Бр╕Ьр╕ер╕зр╕▒р╕Щр╕Чр╕╡р╣И 1 р╕Вр╕нр╕Зр╣Ар╕Фр╕╖р╕нр╕Щр╕Цр╕▒р╕Фр╣Др╕Ы р╣Ар╕зр╕ер╕▓ 16:30
      drawDate = new Date(currentYear, currentMonth + 1, 1);
      resultTime = getBangkokDateAt(16, 30, drawDate);
    } else {
      console.log("тП░ р╣Др╕бр╣Ир╣Гр╕Кр╣Ир╕зр╕▒р╕Щр╕Чр╕╡р╣Ир╕кр╕гр╣Йр╕▓р╕Зр╕лр╕зр╕вр╕нр╕нр╕бр╕кр╕┤р╕Щ (р╕зр╕▒р╕Щр╕Чр╕╡р╣И 2 р╕лр╕гр╕╖р╕н 17)");
      return;
    }

    // р╕кр╕гр╣Йр╕▓р╕Зр╕Кр╕╖р╣Ир╕нр╕Зр╕зр╕Ф
    const monthNames = [
      "р╕бр╕Бр╕гр╕▓р╕Др╕б",
      "р╕Бр╕╕р╕бр╕ар╕▓р╕Юр╕▒р╕Щр╕Шр╣М",
      "р╕бр╕╡р╕Щр╕▓р╕Др╕б",
      "р╣Ар╕бр╕йр╕▓р╕вр╕Щ",
      "р╕Юр╕др╕йр╕ар╕▓р╕Др╕б",
      "р╕бр╕┤р╕Цр╕╕р╕Щр╕▓р╕вр╕Щ",
      "р╕Бр╕гр╕Бр╕Ор╕▓р╕Др╕б",
      "р╕кр╕┤р╕Зр╕лр╕▓р╕Др╕б",
      "р╕Бр╕▒р╕Щр╕вр╕▓р╕вр╕Щ",
      "р╕Хр╕╕р╕ер╕▓р╕Др╕б",
      "р╕Юр╕др╕ир╕Ир╕┤р╕Бр╕▓р╕вр╕Щ",
      "р╕Шр╕▒р╕Щр╕зр╕▓р╕Др╕б",
    ];

    const drawMonth = drawDate.getMonth();
    const drawYear = drawDate.getFullYear() + 543; // р╣Бр╕Ыр╕ер╕Зр╣Ар╕Ыр╣Зр╕Щ р╕Ю.р╕и.
    const roundNumber = drawDate.getDate() === 1 ? 1 : 2;

    const lotteryData = {
      lottery_type_id: lotteryType._id,
      name: "р╕лр╕зр╕вр╕нр╕нр╕бр╕кр╕┤р╕Щ",
      openTime: now, // р╣Ар╕гр╕┤р╣Ир╕бр╣Бр╕Чр╕Зр╣Др╕Фр╣Йр╕Чр╕▒р╕Щр╕Чр╕╡ (р╣Ар╕зр╕ер╕▓р╣Ар╕Лр╕┤р╕гр╣Мр╕Яр╣Ар╕зр╕нр╕гр╣М)
      closeTime: new Date(resultTime.getTime() - 30 * 60 * 1000), // р╕лр╕вр╕╕р╕Фр╣Бр╕Чр╕З 30 р╕Щр╕▓р╕Чр╕╡р╕Бр╣Ир╕нр╕Щр╕нр╕нр╕Бр╕Ьр╕е
      result_time: resultTime,
      status: "scheduled",
    };

    // р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓р╕бр╕╡р╕Зр╕зр╕Фр╕Щр╕╡р╣Йр╣Бр╕ер╣Йр╕зр╕лр╕гр╕╖р╕нр╕вр╕▒р╕З
    const LotterySets = require("../../models/lotterySets.model");
    const existingSet = await LotterySets.findOne({
      name: "р╕лр╕зр╕вр╕нр╕нр╕бр╕кр╕┤р╕Щ",
      result_time: resultTime,
    });

    if (existingSet) {
      console.log(
        `тЪая╕П р╕лр╕зр╕вр╕нр╕нр╕бр╕кр╕┤р╕Щр╕Зр╕зр╕Фр╕зр╕▒р╕Щр╕Чр╕╡р╣И ${drawDate.getDate()} ${
          monthNames[drawMonth]
        } ${drawYear} р╕бр╕╡р╕нр╕вр╕╣р╣Ир╣Бр╕ер╣Йр╕з`
      );
      return existingSet;
    }

    const createdLottery = await createLotterySets(lotteryData);

    console.log(`тЬЕ р╕кр╕гр╣Йр╕▓р╕Зр╕лр╕зр╕вр╕нр╕нр╕бр╕кр╕┤р╕Щр╕кр╕│р╣Ар╕гр╣Зр╕И: ${createdLottery.id}`);
    console.log(
      `ЁЯУЕ р╕зр╕▒р╕Щр╕нр╕нр╕Бр╕Ьр╕е: ${resultTime.toLocaleString("th-TH", {
        timeZone: "Asia/Bangkok",
      })}`
    );

    return createdLottery;
  } catch (error) {
    console.error("тЭМ р╣Ар╕Бр╕┤р╕Фр╕Вр╣Йр╕нр╕Ьр╕┤р╕Фр╕Юр╕ер╕▓р╕Фр╣Гр╕Щр╕Бр╕▓р╕гр╕кр╕гр╣Йр╕▓р╕Зр╕лр╕зр╕вр╕нр╕нр╕бр╕кр╕┤р╕Щ:", error.message);
    throw error;
  }
};

//р╕кр╕гр╣Йр╕▓р╕З lotteryset р╕лр╕зр╕в р╕Шр╕Бр╕к
exports.createThaiGsbLottery = async function () {
  try {
    const { createLotterySets } = require("../lottery/lotterySets.service");
    const LotteryType = require("../../models/lotteryType.model");

    console.log("ЁЯПЫя╕П р╣Ар╕гр╕┤р╣Ир╕бр╕кр╕гр╣Йр╕▓р╕Зр╕лр╕зр╕в р╕Шр╕Бр╕к...");

    // р╕лр╕▓ lottery_type_id р╕кр╕│р╕лр╕гр╕▒р╕Ър╕лр╕зр╕в р╕Шр╕Бр╕к
    const lotteryType = await LotteryType.findOne({ lottery_type: "р╕лр╕зр╕вр╣Др╕Чр╕в" });
    if (!lotteryType) {
      throw new Error("р╣Др╕бр╣Ир╕Юр╕Ър╕Ыр╕гр╕░р╣Ар╕ар╕Чр╕лр╕зр╕вр╣Др╕Чр╕вр╣Гр╕Щр╕гр╕░р╕Ър╕Ъ");
    }

    const now = new Date();
    const currentDate = now.getDate();
    const currentMonth = now.getMonth();
    const currentYear = now.getFullYear();

    let drawDate, resultTime;

    // р╕Цр╣Йр╕▓р╕кр╕гр╣Йр╕▓р╕Зр╕зр╕▒р╕Щр╕Чр╕╡р╣И 17 = р╕нр╕нр╕Бр╕Ьр╕ер╕зр╕▒р╕Щр╕Чр╕╡р╣И 16 р╕Вр╕нр╕Зр╣Ар╕Фр╕╖р╕нр╕Щр╕Цр╕▒р╕Фр╣Др╕Ы
    if (currentDate === 17) {
      // р╕нр╕нр╕Бр╕Ьр╕ер╕зр╕▒р╕Щр╕Чр╕╡р╣И 16 р╕Вр╕нр╕Зр╣Ар╕Фр╕╖р╕нр╕Щр╕Цр╕▒р╕Фр╣Др╕Ы р╣Ар╕зр╕ер╕▓ 16:30
      drawDate = new Date(currentYear, currentMonth + 1, 16);
      resultTime = getBangkokDateAt(16, 30, drawDate);
    } else {
      console.log("тП░ р╣Др╕бр╣Ир╣Гр╕Кр╣Ир╕зр╕▒р╕Щр╕Чр╕╡р╣Ир╕кр╕гр╣Йр╕▓р╕Зр╕лр╕зр╕в р╕Шр╕Бр╕к (р╕зр╕▒р╕Щр╕Чр╕╡р╣И 17)");
      return;
    }

    // р╕кр╕гр╣Йр╕▓р╕Зр╕Кр╕╖р╣Ир╕нр╕Зр╕зр╕Ф
    const monthNames = [
      "р╕бр╕Бр╕гр╕▓р╕Др╕б",
      "р╕Бр╕╕р╕бр╕ар╕▓р╕Юр╕▒р╕Щр╕Шр╣М",
      "р╕бр╕╡р╕Щр╕▓р╕Др╕б",
      "р╣Ар╕бр╕йр╕▓р╕вр╕Щ",
      "р╕Юр╕др╕йр╕ар╕▓р╕Др╕б",
      "р╕бр╕┤р╕Цр╕╕р╕Щр╕▓р╕вр╕Щ",
      "р╕Бр╕гр╕Бр╕Ор╕▓р╕Др╕б",
      "р╕кр╕┤р╕Зр╕лр╕▓р╕Др╕б",
      "р╕Бр╕▒р╕Щр╕вр╕▓р╕вр╕Щ",
      "р╕Хр╕╕р╕ер╕▓р╕Др╕б",
      "р╕Юр╕др╕ир╕Ир╕┤р╕Бр╕▓р╕вр╕Щ",
      "р╕Шр╕▒р╕Щр╕зр╕▓р╕Др╕б",
    ];

    const drawMonth = drawDate.getMonth();
    const drawYear = drawDate.getFullYear() + 543; // р╣Бр╕Ыр╕ер╕Зр╣Ар╕Ыр╣Зр╕Щ р╕Ю.р╕и.

    const lotteryData = {
      lottery_type_id: lotteryType._id,
      name: "р╕лр╕зр╕в р╕Шр╕Бр╕к",
      openTime: now, // р╣Ар╕гр╕┤р╣Ир╕бр╣Бр╕Чр╕Зр╣Др╕Фр╣Йр╕Чр╕▒р╕Щр╕Чр╕╡ (р╣Ар╕зр╕ер╕▓р╣Ар╕Лр╕┤р╕гр╣Мр╕Яр╣Ар╕зр╕нр╕гр╣М)
      closeTime: new Date(resultTime.getTime() - 30 * 60 * 1000), // р╕лр╕вр╕╕р╕Фр╣Бр╕Чр╕З 30 р╕Щр╕▓р╕Чр╕╡р╕Бр╣Ир╕нр╕Щр╕нр╕нр╕Бр╕Ьр╕е
      result_time: resultTime,
      status: "scheduled",
    };

    // р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓р╕бр╕╡р╕Зр╕зр╕Фр╕Щр╕╡р╣Йр╣Бр╕ер╣Йр╕зр╕лр╕гр╕╖р╕нр╕вр╕▒р╕З
    const LotterySets = require("../../models/lotterySets.model");
    const existingSet = await LotterySets.findOne({
      name: "р╕лр╕зр╕в р╕Шр╕Бр╕к",
      result_time: resultTime,
    });

    if (existingSet) {
      console.log(
        `тЪая╕П р╕лр╕зр╕в р╕Шр╕Бр╕к р╕Зр╕зр╕Фр╕зр╕▒р╕Щр╕Чр╕╡р╣И ${drawDate.getDate()} ${
          monthNames[drawMonth]
        } ${drawYear} р╕бр╕╡р╕нр╕вр╕╣р╣Ир╣Бр╕ер╣Йр╕з`
      );
      return existingSet;
    }

    const createdLottery = await createLotterySets(lotteryData);

    console.log(`тЬЕ р╕кр╕гр╣Йр╕▓р╕Зр╕лр╕зр╕в р╕Шр╕Бр╕к р╕кр╕│р╣Ар╕гр╣Зр╕И: ${createdLottery.id}`);
    console.log(
      `ЁЯУЕ р╕зр╕▒р╕Щр╕нр╕нр╕Бр╕Ьр╕е: ${resultTime.toLocaleString("th-TH", {
        timeZone: "Asia/Bangkok",
      })}`
    );

    return createdLottery;
  } catch (error) {
    console.error("тЭМ р╣Ар╕Бр╕┤р╕Фр╕Вр╣Йр╕нр╕Ьр╕┤р╕Фр╕Юр╕ер╕▓р╕Фр╣Гр╕Щр╕Бр╕▓р╕гр╕кр╕гр╣Йр╕▓р╕Зр╕лр╕зр╕в р╕Шр╕Бр╕к:", error.message);
    throw error;
  }
};

// р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╕Чр╕▒р╣Ир╕зр╣Др╕Ыр╕кр╕│р╕лр╕гр╕▒р╕Ър╕кр╕гр╣Йр╕▓р╕Зр╕лр╕зр╕вр╕ер╕▓р╕з
const createLaoLottery = async (lotteryName, drawTime) => {
  try {
    const { createLotterySets } = require("../lottery/lotterySets.service");
    const LotteryType = require("../../models/lotteryType.model");

    console.log(`ЁЯЗ▒ЁЯЗж р╣Ар╕гр╕┤р╣Ир╕бр╕кр╕гр╣Йр╕▓р╕З${lotteryName}...`);

    // р╕лр╕▓ lottery_type_id р╕кр╕│р╕лр╕гр╕▒р╕Ър╕лр╕зр╕вр╕ер╕▓р╕з
    const lotteryType = await LotteryType.findOne({ lottery_type: "р╕лр╕зр╕вр╕ер╕▓р╕з" });
    if (!lotteryType) {
      throw new Error("р╣Др╕бр╣Ир╕Юр╕Ър╕Ыр╕гр╕░р╣Ар╕ар╕Чр╕лр╕зр╕вр╕ер╕▓р╕зр╣Гр╕Щр╕гр╕░р╕Ър╕Ъ");
    }

    const now = new Date();
    const [hours, minutes] = drawTime.split(":").map(Number);

    // р╣Ар╕зр╕ер╕▓р╕Ьр╕ер╕нр╕нр╕Бр╕Хр╕▓р╕бр╣Ар╕нр╕Бр╕кр╕▓р╕гр╣Ар╕Ыр╣Зр╕Щр╣Ар╕зр╕ер╕▓р╣Др╕Чр╕в -> р╣Бр╕Ыр╕ер╕Зр╣Ар╕Ыр╣Зр╕Щр╣Ар╕зр╕ер╕▓р╕Ър╕Щр╣Ар╕Лр╕┤р╕гр╣Мр╕Яр╣Ар╕зр╕нр╕гр╣М
    let resultTime = getBangkokDateAt(hours, minutes, now);

    // р╕Цр╣Йр╕▓р╣Ар╕зр╕ер╕▓р╕Ьр╣Ир╕▓р╕Щр╣Др╕Ыр╣Бр╕ер╣Йр╕з (р╣Ар╕Чр╕╡р╕вр╕Ър╕Хр╕▓р╕бр╣Ар╕зр╕ер╕▓р╣Ар╕Лр╕┤р╕гр╣Мр╕Яр╣Ар╕зр╕нр╕гр╣М) р╣Гр╕лр╣Йр╣Ар╕ер╕╖р╣Ир╕нр╕Щр╣Др╕Ыр╕зр╕▒р╕Щр╕Цр╕▒р╕Фр╣Др╕Ыр╕Вр╕нр╕Зр╣Др╕Чр╕в
    if (resultTime <= now) {
      const nextDayThai = new Date(resultTime.getTime() + 24 * 60 * 60 * 1000);
      resultTime = getBangkokDateAt(hours, minutes, nextDayThai);
    }

    // р╕Др╕│р╕Щр╕зр╕Ур╣Ар╕зр╕ер╕▓р╕Ыр╕┤р╕Фр╕гр╕▒р╕Ър╣Бр╕Чр╕З (1 р╕Щр╕▓р╕Чр╕╡р╕Бр╣Ир╕нр╕Щр╕нр╕нр╕Бр╕Ьр╕е)
    const closeTime = new Date(resultTime.getTime() - 1 * 60 * 1000);

    // р╕Цр╣Йр╕▓р╣Ар╕зр╕ер╕▓р╕Ыр╕┤р╕Фр╕Щр╣Йр╕нр╕вр╕Бр╕зр╣Ир╕▓р╕лр╕гр╕╖р╕нр╣Ар╕Чр╣Ир╕▓р╕Бр╕▒р╕Ър╣Ар╕зр╕ер╕▓р╕Ыр╕▒р╕Ир╕Ир╕╕р╕Ър╕▒р╕Щ р╣Гр╕лр╣Йр╣Гр╕Кр╣Йр╣Ар╕зр╕ер╕▓р╕Ыр╕▒р╕Ир╕Ир╕╕р╕Ър╕▒р╕Щр╕Ър╕зр╕Б 1 р╕Щр╕▓р╕Чр╕╡
    const finalCloseTime =
      closeTime <= now ? new Date(now.getTime() + 60 * 1000) : closeTime;

    const lotteryData = {
      lottery_type_id: lotteryType._id,
      name: lotteryName,
      openTime: now, // р╣Ар╕гр╕┤р╣Ир╕бр╣Бр╕Чр╕Зр╣Др╕Фр╣Йр╕Чр╕▒р╕Щр╕Чр╕╡
      closeTime: finalCloseTime, // р╕лр╕вр╕╕р╕Фр╣Бр╕Чр╕Зр╕Бр╣Ир╕нр╕Щр╕нр╕нр╕Бр╕Ьр╕е (р╕нр╕вр╣Ир╕▓р╕Зр╕Щр╣Йр╕нр╕в 1 р╕Щр╕▓р╕Чр╕╡р╕лр╕ер╕▒р╕Зр╕Ир╕▓р╕Бр╣Ар╕Ыр╕┤р╕Ф)
      result_time: resultTime,
      status: "scheduled",
    };

    // р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓р╕бр╕╡р╕Зр╕зр╕Фр╕Щр╕╡р╣Йр╣Бр╕ер╣Йр╕зр╕лр╕гр╕╖р╕нр╕вр╕▒р╕З
    const LotterySets = require("../../models/lotterySets.model");
    const existingSet = await LotterySets.findOne({
      name: lotteryName,
      result_time: resultTime,
    });

    if (existingSet) {
      console.log(
        `тЪая╕П ${lotteryName} р╕Зр╕зр╕Фр╣Ар╕зр╕ер╕▓ ${resultTime.toLocaleString("th-TH", {
          timeZone: "Asia/Bangkok",
        })} р╕бр╕╡р╕нр╕вр╕╣р╣Ир╣Бр╕ер╣Йр╕з`
      );
      return existingSet;
    }

    const createdLottery = await createLotterySets(lotteryData);

    console.log(`тЬЕ р╕кр╕гр╣Йр╕▓р╕З${lotteryName}р╕кр╕│р╣Ар╕гр╣Зр╕И: ${createdLottery.id}`);
    console.log(
      `ЁЯУЕ р╕зр╕▒р╕Щр╕нр╕нр╕Бр╕Ьр╕е: ${resultTime.toLocaleString("th-TH", {
        timeZone: "Asia/Bangkok",
      })}`
    );

    return createdLottery;
  } catch (error) {
    console.error(`тЭМ р╣Ар╕Бр╕┤р╕Фр╕Вр╣Йр╕нр╕Ьр╕┤р╕Фр╕Юр╕ер╕▓р╕Фр╣Гр╕Щр╕Бр╕▓р╕гр╕кр╕гр╣Йр╕▓р╕З${lotteryName}:`, error.message);
    throw error;
  }
};

// р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╕кр╕│р╕лр╕гр╕▒р╕Ър╕кр╕гр╣Йр╕▓р╕Зр╕лр╕зр╕вр╕ер╕▓р╕з HD
exports.createLaoHdLottery = async function () {
  return await createLaoLottery("р╕лр╕зр╕вр╕ер╕▓р╕з HD", "13:45");
};

// р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╕кр╕│р╕лр╕гр╕▒р╕Ър╕кр╕гр╣Йр╕▓р╕Зр╕лр╕зр╕вр╕ер╕▓р╕зр╕кр╕Хр╕▓р╕гр╣М
exports.createLaoStarsLottery = async function () {
  return await createLaoLottery("р╕лр╕зр╕вр╕ер╕▓р╕зр╕кр╕Хр╕▓р╕гр╣М", "15:45");
};

// р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╕кр╕│р╕лр╕гр╕▒р╕Ър╕кр╕гр╣Йр╕▓р╕Зр╕лр╕зр╕вр╕ер╕▓р╕зр╕Чр╣Ир╕▓р╣Бр╕Вр╕Б VIP
exports.createLaoThakhekVipLottery = async function () {
  return await createLaoLottery("р╕лр╕зр╕вр╕ер╕▓р╕зр╕Чр╣Ир╕▓р╣Бр╕Вр╕Б VIP", "20:00");
};

// р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╕кр╕│р╕лр╕гр╕▒р╕Ър╕кр╕гр╣Йр╕▓р╕Зр╕лр╕зр╕вр╕ер╕▓р╕зр╕Чр╣Ир╕▓р╣Бр╕Вр╕Б 5D
exports.createLaoThakhek5dLottery = async function () {
  return await createLaoLottery("р╕лр╕зр╕вр╕ер╕▓р╕зр╕Чр╣Ир╕▓р╣Бр╕Вр╕Б 5D", "21:45");
};

// р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╕кр╕│р╕лр╕гр╕▒р╕Ър╕кр╕гр╣Йр╕▓р╕Зр╕лр╕зр╕вр╕ер╕▓р╕зр╕кр╕▓р╕бр╕▒р╕Др╕Др╕╡
exports.createLaoUnionLottery = async function () {
  return await createLaoLottery("р╕лр╕зр╕вр╕ер╕▓р╕зр╕кр╕▓р╕бр╕▒р╕Др╕Др╕╡", "20:40");
};

// р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╕кр╕│р╕лр╕гр╕▒р╕Ър╕кр╕гр╣Йр╕▓р╕Зр╕лр╕зр╕вр╕ер╕▓р╕з VIP
exports.createLaoVipLottery = async function () {
  return await createLaoLottery("р╕лр╕зр╕вр╕ер╕▓р╕з VIP", "21:30");
};

// р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╕кр╕│р╕лр╕гр╕▒р╕Ър╕кр╕гр╣Йр╕▓р╕Зр╕лр╕зр╕вр╕ер╕▓р╕зр╕кр╕Хр╕▓р╕гр╣М VIP
exports.createLaoStarsVipLottery = async function () {
  return await createLaoLottery("р╕лр╕зр╕вр╕ер╕▓р╕зр╕кр╕Хр╕▓р╕гр╣М VIP", "22:05");
};

// р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╕кр╕│р╕лр╕гр╕▒р╕Ър╕кр╕гр╣Йр╕▓р╕Зр╕лр╕зр╕вр╕ер╕▓р╕зр╕Бр╕▓р╕Кр╕▓р╕Ф
exports.createLaoRedcrossLottery = async function () {
  return await createLaoLottery("р╕лр╕зр╕вр╕ер╕▓р╕зр╕Бр╕▓р╕Кр╕▓р╕Ф", "23:30");
};

// р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╕кр╕│р╕лр╕гр╕▒р╕Ър╕кр╕гр╣Йр╕▓р╕Зр╕лр╕зр╕вр╕ер╕▓р╕зр╕Юр╕▒р╕Тр╕Щр╕▓
exports.createLaoDevelopLottery = async function () {
  return await createLaoLottery("р╕лр╕зр╕вр╕ер╕▓р╕зр╕Юр╕▒р╕Тр╕Щр╕▓", "20:30");
};

// р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╕кр╕│р╕лр╕гр╕▒р╕Ър╕кр╕гр╣Йр╕▓р╕Зр╕лр╕зр╕вр╕ер╕▓р╕з Extra
exports.createLaoExtraLottery = async function () {
  return await createLaoLottery("р╕лр╕зр╕вр╕ер╕▓р╕з Extra", "08:30");
};

// р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╕кр╕│р╕лр╕гр╕▒р╕Ър╕кр╕гр╣Йр╕▓р╕Зр╕лр╕зр╕вр╕ер╕▓р╕з TV
exports.createLaoTvLottery = async function () {
  return await createLaoLottery("р╕лр╕зр╕вр╕ер╕▓р╕з TV", "10:30");
};

// ============= р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╕кр╕│р╕лр╕гр╕▒р╕Ър╕лр╕зр╕в 4D =============

// р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╕Чр╕▒р╣Ир╕зр╣Др╕Ыр╕кр╕│р╕лр╕гр╕▒р╕Ър╕кр╕гр╣Йр╕▓р╕Зр╕лр╕зр╕в 4D
const create4dLottery = async (
  lotteryName,
  drawTime,
  lotteryTypeStr = "р╕лр╕зр╕в 4D"
) => {
  try {
    const { createLotterySets } = require("../lottery/lotterySets.service");
    const LotteryType = require("../../models/lotteryType.model");

    console.log(`ЁЯО▓ р╣Ар╕гр╕┤р╣Ир╕бр╕кр╕гр╣Йр╕▓р╕З${lotteryName}...`);

    // р╕лр╕▓ lottery_type_id р╕кр╕│р╕лр╕гр╕▒р╕Ър╕лр╕зр╕в 4D
    const lotteryType = await LotteryType.findOne({
      lottery_type: lotteryTypeStr,
    });
    if (!lotteryType) {
      throw new Error(`р╣Др╕бр╣Ир╕Юр╕Ър╕Ыр╕гр╕░р╣Ар╕ар╕Ч${lotteryTypeStr}р╣Гр╕Щр╕гр╕░р╕Ър╕Ъ`);
    }

    const now = new Date();
    const [hours, minutes] = drawTime.split(":").map(Number);

    // р╣Ар╕зр╕ер╕▓р╕Ьр╕ер╕нр╕нр╕Бр╣Ар╕Ыр╣Зр╕Щр╣Ар╕зр╕ер╕▓р╣Др╕Чр╕в -> р╣Бр╕Ыр╕ер╕Зр╣Ар╕Ыр╣Зр╕Щр╣Ар╕зр╕ер╕▓р╕Ър╕Щр╣Ар╕Лр╕┤р╕гр╣Мр╕Яр╣Ар╕зр╕нр╕гр╣М
    let resultTime = getBangkokDateAt(hours, minutes, now);
    if (resultTime <= now) {
      const nextDayThai = new Date(resultTime.getTime() + 24 * 60 * 60 * 1000);
      resultTime = getBangkokDateAt(hours, minutes, nextDayThai);
    }

    // р╕Бр╕│р╕лр╕Щр╕Фр╣Ар╕зр╕ер╕▓р╣Ар╕Ыр╕┤р╕Фр╣Бр╕Чр╕Зр╣Ар╕Ыр╣Зр╕Щр╣Ар╕Чр╕╡р╣Ир╕вр╕Зр╕Др╕╖р╕Щр╕Вр╕нр╕Зр╕зр╕▒р╕Щр╣Ар╕Фр╕╡р╕вр╕зр╕Бр╕▒р╕Ъ resultTime (р╣Ар╕зр╕ер╕▓р╣Др╕Чр╕в)
    const openTime = getBangkokMidnight(resultTime);

    const lotteryData = {
      lottery_type_id: lotteryType._id,
      name: lotteryName,
      openTime: openTime, // р╣Ар╕Ыр╕┤р╕Фр╣Бр╕Чр╕Зр╣Ар╕Чр╕╡р╣Ир╕вр╕Зр╕Др╕╖р╕Щ
      closeTime: new Date(resultTime.getTime() - 10 * 60 * 1000), // р╕лр╕вр╕╕р╕Фр╣Бр╕Чр╕З 10 р╕Щр╕▓р╕Чр╕╡р╕Бр╣Ир╕нр╕Щр╕нр╕нр╕Бр╕Ьр╕е
      result_time: resultTime,
      status: "scheduled",
    };

    // р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓р╕бр╕╡р╕Зр╕зр╕Фр╕Щр╕╡р╣Йр╣Бр╕ер╣Йр╕зр╕лр╕гр╕╖р╕нр╕вр╕▒р╕З
    const LotterySets = require("../../models/lotterySets.model");
    const existingSet = await LotterySets.findOne({
      name: lotteryName,
      result_time: resultTime,
    });

    if (existingSet) {
      console.log(
        `тЪая╕П ${lotteryName} р╕Зр╕зр╕Фр╣Ар╕зр╕ер╕▓ ${resultTime.toLocaleString("th-TH", {
          timeZone: "Asia/Bangkok",
        })} р╕бр╕╡р╕нр╕вр╕╣р╣Ир╣Бр╕ер╣Йр╕з`
      );
      return existingSet;
    }

    const createdLottery = await createLotterySets(lotteryData);

    console.log(`тЬЕ р╕кр╕гр╣Йр╕▓р╕З${lotteryName}р╕кр╕│р╣Ар╕гр╣Зр╕И: ${createdLottery.id}`);
    console.log(
      `ЁЯУЕ р╣Ар╕Ыр╕┤р╕Фр╣Бр╕Чр╕З: ${openTime.toLocaleString("th-TH", {
        timeZone: "Asia/Bangkok",
      })}`
    );
    console.log(
      `ЁЯУЕ р╕зр╕▒р╕Щр╕нр╕нр╕Бр╕Ьр╕е: ${resultTime.toLocaleString("th-TH", {
        timeZone: "Asia/Bangkok",
      })}`
    );

    return createdLottery;
  } catch (error) {
    console.error(`тЭМ р╣Ар╕Бр╕┤р╕Фр╕Вр╣Йр╕нр╕Ьр╕┤р╕Фр╕Юр╕ер╕▓р╕Фр╣Гр╕Щр╕Бр╕▓р╕гр╕кр╕гр╣Йр╕▓р╕З${lotteryName}:`, error.message);
    throw error;
  }
};

// р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╕кр╕│р╕лр╕гр╕▒р╕Ър╕кр╕гр╣Йр╕▓р╕Зр╕лр╕зр╕в Magnum 4D
exports.createMagnum4dLottery = async function () {
  return await create4dLottery("р╕лр╕зр╕в Magnum 4D", "18:00");
};

// р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╕кр╕│р╕лр╕гр╕▒р╕Ър╕кр╕гр╣Йр╕▓р╕Зр╕лр╕зр╕в Singapore 4D
exports.createSingapore4dLottery = async function () {
  return await create4dLottery("р╕лр╕зр╕в Singapore 4D", "17:30");
};

// р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╕кр╕│р╕лр╕гр╕▒р╕Ър╕кр╕гр╣Йр╕▓р╕Зр╕лр╕зр╕в Grand Dragon 4D
exports.createGrandDragon4dLottery = async function () {
  return await create4dLottery("р╕лр╕зр╕в Grand Dragon 4D", "18:10");
};

// ============= р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╕кр╕│р╕лр╕гр╕▒р╕Ър╕лр╕зр╕вр╕ор╕▓р╕Щр╕нр╕в =============

// р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╕Чр╕▒р╣Ир╕зр╣Др╕Ыр╕кр╕│р╕лр╕гр╕▒р╕Ър╕кр╕гр╣Йр╕▓р╕Зр╕лр╕зр╕вр╕ор╕▓р╕Щр╕нр╕в
const createHanoiLottery = async (
  lotteryName,
  drawTime,
  lotteryTypeStr = "р╕лр╕зр╕вр╕ор╕▓р╕Щр╕нр╕в"
) => {
  try {
    const { createLotterySets } = require("../lottery/lotterySets.service");
    const LotteryType = require("../../models/lotteryType.model");

    console.log(`ЁЯЗ╗ЁЯЗ│ р╣Ар╕гр╕┤р╣Ир╕бр╕кр╕гр╣Йр╕▓р╕З${lotteryName}...`);

    // р╕лр╕▓ lottery_type_id р╕кр╕│р╕лр╕гр╕▒р╕Ър╕лр╕зр╕вр╕ор╕▓р╕Щр╕нр╕в
    const lotteryType = await LotteryType.findOne({
      lottery_type: lotteryTypeStr,
    });
    if (!lotteryType) {
      throw new Error(`р╣Др╕бр╣Ир╕Юр╕Ър╕Ыр╕гр╕░р╣Ар╕ар╕Ч${lotteryTypeStr}р╣Гр╕Щр╕гр╕░р╕Ър╕Ъ`);
    }

    const now = new Date();
    const [hours, minutes] = drawTime.split(":").map(Number);

    // р╣Ар╕зр╕ер╕▓р╕Ьр╕ер╕нр╕нр╕Бр╣Ар╕Ыр╣Зр╕Щр╣Ар╕зр╕ер╕▓р╣Др╕Чр╕в -> р╣Бр╕Ыр╕ер╕Зр╣Ар╕Ыр╣Зр╕Щр╣Ар╕зр╕ер╕▓р╕Ър╕Щр╣Ар╕Лр╕┤р╕гр╣Мр╕Яр╣Ар╕зр╕нр╕гр╣М
    let resultTime = getBangkokDateAt(hours, minutes, now);
    if (resultTime <= now) {
      const nextDayThai = new Date(resultTime.getTime() + 24 * 60 * 60 * 1000);
      resultTime = getBangkokDateAt(hours, minutes, nextDayThai);
    }

    // р╕Бр╕│р╕лр╕Щр╕Фр╣Ар╕зр╕ер╕▓р╣Ар╕Ыр╕┤р╕Фр╣Бр╕Чр╕Зр╣Ар╕Ыр╣Зр╕Щр╣Ар╕Чр╕╡р╣Ир╕вр╕Зр╕Др╕╖р╕Щр╕Вр╕нр╕Зр╕зр╕▒р╕Щр╣Ар╕Фр╕╡р╕вр╕зр╕Бр╕▒р╕Ъ resultTime (р╣Ар╕зр╕ер╕▓р╣Др╕Чр╕в)
    const openTime = getBangkokMidnight(resultTime);

    const lotteryData = {
      lottery_type_id: lotteryType._id,
      name: lotteryName,
      openTime: openTime, // р╣Ар╕Ыр╕┤р╕Фр╣Бр╕Чр╕Зр╣Ар╕Чр╕╡р╣Ир╕вр╕Зр╕Др╕╖р╕Щ
      closeTime: resultTime, // р╕Ыр╕┤р╕Фр╣Бр╕Чр╕Зр╕Хр╕гр╕Зр╣Ар╕зр╕ер╕▓р╕нр╕нр╕Бр╕Ьр╕е
      result_time: resultTime,
      status: "scheduled",
    };

    // р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓р╕бр╕╡р╕Зр╕зр╕Фр╕Щр╕╡р╣Йр╣Бр╕ер╣Йр╕зр╕лр╕гр╕╖р╕нр╕вр╕▒р╕З
    const LotterySets = require("../../models/lotterySets.model");
    const existingSet = await LotterySets.findOne({
      name: lotteryName,
      result_time: resultTime,
    });

    if (existingSet) {
      console.log(
        `тЪая╕П ${lotteryName} р╕Зр╕зр╕Фр╣Ар╕зр╕ер╕▓ ${resultTime.toLocaleString("th-TH", {
          timeZone: "Asia/Bangkok",
        })} р╕бр╕╡р╕нр╕вр╕╣р╣Ир╣Бр╕ер╣Йр╕з`
      );
      return existingSet;
    }

    const createdLottery = await createLotterySets(lotteryData);

    console.log(`тЬЕ р╕кр╕гр╣Йр╕▓р╕З${lotteryName}р╕кр╕│р╣Ар╕гр╣Зр╕И: ${createdLottery.id}`);
    console.log(
      `ЁЯУЕ р╣Ар╕Ыр╕┤р╕Фр╣Бр╕Чр╕З: ${openTime.toLocaleString("th-TH", {
        timeZone: "Asia/Bangkok",
      })}`
    );
    console.log(
      `ЁЯУЕ р╕Ыр╕┤р╕Фр╣Бр╕Чр╕З/р╕нр╕нр╕Бр╕Ьр╕е: ${resultTime.toLocaleString("th-TH", {
        timeZone: "Asia/Bangkok",
      })}`
    );

    return createdLottery;
  } catch (error) {
    console.error(`тЭМ р╣Ар╕Бр╕┤р╕Фр╕Вр╣Йр╕нр╕Ьр╕┤р╕Фр╕Юр╕ер╕▓р╕Фр╣Гр╕Щр╕Бр╕▓р╕гр╕кр╕гр╣Йр╕▓р╕З${lotteryName}:`, error.message);
    throw error;
  }
};

// р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╕кр╕│р╕лр╕гр╕▒р╕Ър╕кр╕гр╣Йр╕▓р╕Зр╕ор╕▓р╕Щр╕нр╕вр╕нр╕▓р╣Ар╕Лр╕╡р╕вр╕Щ
exports.createHanoiAseanLottery = async function () {
  return await createHanoiLottery("р╕лр╕зр╕вр╕ор╕▓р╕Щр╕нр╕вр╕нр╕▓р╣Ар╕Лр╕╡р╕вр╕Щ", "09:30");
};

// р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╕кр╕│р╕лр╕гр╕▒р╕Ър╕кр╕гр╣Йр╕▓р╕Зр╕лр╕зр╕вр╕ор╕▓р╕Щр╕нр╕в HD
exports.createHanoiHdLottery = async function () {
  return await createHanoiLottery("р╕лр╕зр╕вр╕ор╕▓р╕Щр╕нр╕в HD", "11:30");
};

// р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╕кр╕│р╕лр╕гр╕▒р╕Ър╕кр╕гр╣Йр╕▓р╕Зр╕лр╕зр╕вр╕ор╕▓р╕Щр╕нр╕вр╕кр╕Хр╕▓р╕гр╣М
exports.createHanoiStarLottery = async function () {
  return await createHanoiLottery("р╕лр╕зр╕вр╕ор╕▓р╕Щр╕нр╕вр╕кр╕Хр╕▓р╕гр╣М", "12:30");
};

// р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╕кр╕│р╕лр╕гр╕▒р╕Ър╕кр╕гр╣Йр╕▓р╕Зр╕лр╕зр╕вр╕ор╕▓р╕Щр╕нр╕в TV
exports.createHanoiTvLottery = async function () {
  return await createHanoiLottery("р╕лр╕зр╕вр╕ор╕▓р╕Щр╕нр╕в TV", "14:30");
};

// р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╕кр╕│р╕лр╕гр╕▒р╕Ър╕кр╕гр╣Йр╕▓р╕Зр╕лр╕зр╕вр╕ор╕▓р╕Щр╕нр╕вр╣Ар╕Йр╕Юр╕▓р╕░р╕Бр╕┤р╕И
exports.createHanoiSpecialLottery = async function () {
  return await createHanoiLottery("р╕лр╕зр╕вр╕ор╕▓р╕Щр╕нр╕вр╣Ар╕Йр╕Юр╕▓р╕░р╕Бр╕┤р╕И", "16:30");
};

// р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╕кр╕│р╕лр╕гр╕▒р╕Ър╕кр╕гр╣Йр╕▓р╕Зр╕лр╕зр╕вр╕ор╕▓р╕Щр╕нр╕вр╕Бр╕▓р╕Кр╕▓р╕Ф
exports.createHanoiRedcrossLottery = async function () {
  return await createHanoiLottery("р╕лр╕зр╕вр╕ор╕▓р╕Щр╕нр╕вр╕Бр╕▓р╕Кр╕▓р╕Ф", "16:30");
};

// р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╕кр╕│р╕лр╕гр╕▒р╕Ър╕кр╕гр╣Йр╕▓р╕Зр╕лр╕зр╕вр╕ор╕▓р╕Щр╕нр╕вр╕Юр╕┤р╣Ар╕ир╕й
exports.createHanoiSpecialApiLottery = async function () {
  return await createHanoiLottery("р╕лр╕зр╕вр╕ор╕▓р╕Щр╕нр╕вр╕Юр╕┤р╣Ар╕ир╕й", "17:30");
};

// р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╕кр╕│р╕лр╕гр╕▒р╕Ър╕кр╕гр╣Йр╕▓р╕Зр╕лр╕зр╕вр╕ор╕▓р╕Щр╕нр╕в
exports.createHanoiLottery = async function () {
  return await createHanoiLottery("р╕лр╕зр╕вр╕ор╕▓р╕Щр╕нр╕в", "18:30");
};

// р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╕кр╕│р╕лр╕гр╕▒р╕Ър╕кр╕гр╣Йр╕▓р╕Зр╕лр╕зр╕вр╕ор╕▓р╕Щр╕нр╕вр╕Юр╕▒р╕Тр╕Щр╕▓
exports.createHanoiDevelopLottery = async function () {
  return await createHanoiLottery("р╕лр╕зр╕вр╕ор╕▓р╕Щр╕нр╕вр╕Юр╕▒р╕Тр╕Щр╕▓", "19:30");
};

// р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╕кр╕│р╕лр╕гр╕▒р╕Ър╕кр╕гр╣Йр╕▓р╕Зр╕лр╕зр╕вр╕ор╕▓р╕Щр╕нр╕в VIP
exports.createHanoiVipLottery = async function () {
  return await createHanoiLottery("р╕лр╕зр╕вр╕ор╕▓р╕Щр╕нр╕в VIP", "19:30");
};

// р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╕кр╕│р╕лр╕гр╕▒р╕Ър╕кр╕гр╣Йр╕▓р╕Зр╕лр╕зр╕вр╕ор╕▓р╕Щр╕нр╕в EXTRA
exports.createHanoiExtraLottery = async function () {
  return await createHanoiLottery("р╕лр╕зр╕вр╕ор╕▓р╕Щр╕нр╕в EXTRA", "22:15");
};

// ============= WRAPPER FUNCTIONS р╕кр╕│р╕лр╕гр╕▒р╕Ъ CRONJOBS р╕Юр╕гр╣Йр╕нр╕б LOGGING =============

// р╕лр╕зр╕вр╣Др╕Чр╕в
exports.createThaiGovernmentLotteryWithLog = async function () {
  return await createCronjobWithLogging(
    "createThaiGovernmentLottery",
    "р╕лр╕зр╕вр╕гр╕▒р╕Рр╕Ър╕▓р╕е",
    exports.createThaiGovernmentLottery
  );
};

exports.createThaiSavingsLotteryWithLog = async function () {
  return await createCronjobWithLogging(
    "createThaiSavingsLottery",
    "р╕лр╕зр╕вр╕нр╕нр╕бр╕кр╕┤р╕Щ",
    exports.createThaiSavingsLottery
  );
};

exports.createThaiGsbLotteryWithLog = async function () {
  return await createCronjobWithLogging(
    "createThaiGsbLottery",
    "р╕лр╕зр╕в р╕Шр╕Бр╕к",
    exports.createThaiGsbLottery
  );
};

// р╕лр╕зр╕вр╕ер╕▓р╕з
exports.createLaoHdLotteryWithLog = async function () {
  return await createCronjobWithLogging(
    "createLaoHdLottery",
    "р╕лр╕зр╕вр╕ер╕▓р╕з HD",
    exports.createLaoHdLottery
  );
};

exports.createLaoStarsLotteryWithLog = async function () {
  return await createCronjobWithLogging(
    "createLaoStarsLottery",
    "р╕лр╕зр╕вр╕ер╕▓р╕зр╕кр╕Хр╕▓р╕гр╣М",
    exports.createLaoStarsLottery
  );
};

exports.createLaoThakhekVipLotteryWithLog = async function () {
  return await createCronjobWithLogging(
    "createLaoThakhekVipLottery",
    "р╕лр╕зр╕вр╕ер╕▓р╕зр╕Чр╣Ир╕▓р╣Бр╕Вр╕Б VIP",
    exports.createLaoThakhekVipLottery
  );
};

exports.createLaoThakhek5dLotteryWithLog = async function () {
  return await createCronjobWithLogging(
    "createLaoThakhek5dLottery",
    "р╕лр╕зр╕вр╕ер╕▓р╕зр╕Чр╣Ир╕▓р╣Бр╕Вр╕Б 5D",
    exports.createLaoThakhek5dLottery
  );
};

exports.createLaoUnionLotteryWithLog = async function () {
  return await createCronjobWithLogging(
    "createLaoUnionLottery",
    "р╕лр╕зр╕вр╕ер╕▓р╕зр╕кр╕▓р╕бр╕▒р╕Др╕Др╕╡",
    exports.createLaoUnionLottery
  );
};

exports.createLaoVipLotteryWithLog = async function () {
  return await createCronjobWithLogging(
    "createLaoVipLottery",
    "р╕лр╕зр╕вр╕ер╕▓р╕з VIP",
    exports.createLaoVipLottery
  );
};

exports.createLaoStarsVipLotteryWithLog = async function () {
  return await createCronjobWithLogging(
    "createLaoStarsVipLottery",
    "р╕лр╕зр╕вр╕ер╕▓р╕зр╕кр╕Хр╕▓р╕гр╣М VIP",
    exports.createLaoStarsVipLottery
  );
};

exports.createLaoRedcrossLotteryWithLog = async function () {
  return await createCronjobWithLogging(
    "createLaoRedcrossLottery",
    "р╕лр╕зр╕вр╕ер╕▓р╕зр╕Бр╕▓р╕Кр╕▓р╕Ф",
    exports.createLaoRedcrossLottery
  );
};

exports.createLaoDevelopLotteryWithLog = async function () {
  return await createCronjobWithLogging(
    "createLaoDevelopLottery",
    "р╕лр╕зр╕вр╕ер╕▓р╕зр╕Юр╕▒р╕Тр╕Щр╕▓",
    exports.createLaoDevelopLottery
  );
};

exports.createLaoExtraLotteryWithLog = async function () {
  return await createCronjobWithLogging(
    "createLaoExtraLottery",
    "р╕лр╕зр╕вр╕ер╕▓р╕з Extra",
    exports.createLaoExtraLottery
  );
};

exports.createLaoTvLotteryWithLog = async function () {
  return await createCronjobWithLogging(
    "createLaoTvLottery",
    "р╕лр╕зр╕вр╕ер╕▓р╕з TV",
    exports.createLaoTvLottery
  );
};

// р╕лр╕зр╕в 4D
exports.createMagnum4dLotteryWithLog = async function () {
  return await createCronjobWithLogging(
    "createMagnum4dLottery",
    "р╕лр╕зр╕в Magnum 4D",
    exports.createMagnum4dLottery
  );
};

exports.createSingapore4dLotteryWithLog = async function () {
  return await createCronjobWithLogging(
    "createSingapore4dLottery",
    "р╕лр╕зр╕в Singapore 4D",
    exports.createSingapore4dLottery
  );
};

exports.createGrandDragon4dLotteryWithLog = async function () {
  return await createCronjobWithLogging(
    "createGrandDragon4dLottery",
    "р╕лр╕зр╕в Grand Dragon 4D",
    exports.createGrandDragon4dLottery
  );
};

// р╕лр╕зр╕вр╕ор╕▓р╕Щр╕нр╕в
exports.createHanoiAseanLotteryWithLog = async function () {
  return await createCronjobWithLogging(
    "createHanoiAseanLottery",
    "р╕лр╕зр╕вр╕ор╕▓р╕Щр╕нр╕вр╕нр╕▓р╣Ар╕Лр╕╡р╕вр╕Щ",
    exports.createHanoiAseanLottery
  );
};

exports.createHanoiHdLotteryWithLog = async function () {
  return await createCronjobWithLogging(
    "createHanoiHdLottery",
    "р╕лр╕зр╕вр╕ор╕▓р╕Щр╕нр╕в HD",
    exports.createHanoiHdLottery
  );
};

exports.createHanoiStarLotteryWithLog = async function () {
  return await createCronjobWithLogging(
    "createHanoiStarLottery",
    "р╕лр╕зр╕вр╕ор╕▓р╕Щр╕нр╕вр╕кр╕Хр╕▓р╕гр╣М",
    exports.createHanoiStarLottery
  );
};

exports.createHanoiTvLotteryWithLog = async function () {
  return await createCronjobWithLogging(
    "createHanoiTvLottery",
    "р╕лр╕зр╕вр╕ор╕▓р╕Щр╕нр╕в TV",
    exports.createHanoiTvLottery
  );
};

exports.createHanoiSpecialLotteryWithLog = async function () {
  return await createCronjobWithLogging(
    "createHanoiSpecialLottery",
    "р╕лр╕зр╕вр╕ор╕▓р╕Щр╕нр╕вр╣Ар╕Йр╕Юр╕▓р╕░р╕Бр╕┤р╕И",
    exports.createHanoiSpecialLottery
  );
};

exports.createHanoiRedcrossLotteryWithLog = async function () {
  return await createCronjobWithLogging(
    "createHanoiRedcrossLottery",
    "р╕лр╕зр╕вр╕ор╕▓р╕Щр╕нр╕вр╕Бр╕▓р╕Кр╕▓р╕Ф",
    exports.createHanoiRedcrossLottery
  );
};

exports.createHanoiSpecialApiLotteryWithLog = async function () {
  return await createCronjobWithLogging(
    "createHanoiSpecialApiLottery",
    "р╕лр╕зр╕вр╕ор╕▓р╕Щр╕нр╕вр╕Юр╕┤р╣Ар╕ир╕й",
    exports.createHanoiSpecialApiLottery
  );
};

exports.createHanoiLotteryWithLog = async function () {
  return await createCronjobWithLogging(
    "createHanoiLottery",
    "р╕лр╕зр╕вр╕ор╕▓р╕Щр╕нр╕в",
    exports.createHanoiLottery
  );
};

exports.createHanoiDevelopLotteryWithLog = async function () {
  return await createCronjobWithLogging(
    "createHanoiDevelopLottery",
    "р╕лр╕зр╕вр╕ор╕▓р╕Щр╕нр╕вр╕Юр╕▒р╕Тр╕Щр╕▓",
    exports.createHanoiDevelopLottery
  );
};

exports.createHanoiVipLotteryWithLog = async function () {
  return await createCronjobWithLogging(
    "createHanoiVipLottery",
    "р╕лр╕зр╕вр╕ор╕▓р╕Щр╕нр╕в VIP",
    exports.createHanoiVipLottery
  );
};

exports.createHanoiExtraLotteryWithLog = async function () {
  return await createCronjobWithLogging(
    "createHanoiExtraLottery",
    "р╕лр╕зр╕вр╕ор╕▓р╕Щр╕нр╕в EXTRA",
    exports.createHanoiExtraLottery
  );
};
